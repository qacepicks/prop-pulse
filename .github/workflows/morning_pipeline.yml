name: PropPulse Morning Pipeline

on:
  schedule:
    - cron: "0 9 * * *"    # 1:00 AM PST (early board fetch)
    - cron: "10 9 * * *"   # 1:10 AM PST (logs refresh)
    - cron: "15 9 * * *"   # 1:15 AM PST (DvP refresh)
    - cron: "20 9 * * *"   # 1:20 AM PST (early EV run)
    - cron: "0 13 * * *"   # 5:00 AM PST (full board fetch)
    - cron: "10 13 * * *"  # 5:10 AM PST (logs refresh)
    - cron: "15 13 * * *"  # 5:15 AM PST (full EV run + sheet update)
  workflow_dispatch: {}

jobs:
  morning_pipeline:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt

      # 1:00 AM — EARLY BOARD
      - name: Early PrizePicks Fetch
        if: github.event.schedule == '0 9 * * *'
        run: python auto_prop_scraper.py

      # 1:10 AM — LOG REFRESH
      - name: Refresh Logs
        if: github.event.schedule == '10 9 * * *'
        run: python nba_stats_fetcher.py

      # 1:15 AM — DvP REFRESH
      - name: Refresh DvP
        if: github.event.schedule == '15 9 * * *'
        run: python dvp_updater.py

      # 1:20 AM — EARLY EV
      - name: Early EV Run
        if: github.event.schedule == '20 9 * * *'
        run: python auto_prop_scraper.py

      # 5:00 AM — FULL BOARD FETCH
      - name: Full PrizePicks Fetch
        if: github.event.schedule == '0 13 * * *'
        run: python auto_prop_scraper.py

      # 5:10 AM — LOG REFRESH (FULL)
      - name: Refresh Logs for Full Board
        if: github.event.schedule == '10 13 * * *'
        run: python nba_stats_fetcher.py

      # 5:15 AM — FULL EV RUN
      - name: Full EV Run & Sheet Update
        if: github.event.schedule == '15 13 * * *'
        run: python auto_prop_scraper.py
